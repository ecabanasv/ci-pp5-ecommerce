{% load static %}

<!DOCTYPE html>
<html lang="en">
  <head>
    {% block meta %}
    <!-- Required meta tags -->
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Get the best books at ecabanas shop! Shop our wide selection of books and find the perfect read for you. Free shipping available on all orders.">
    <meta name="keywords" content="books, e-commerce, online shopping, best books, ecabanas shop, reading, literature, fiction, non-fiction, bestsellers">
    <meta name="author" content="ecabanas shop">
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    {% endblock %} 
    {% block extra_meta %} 
    {% endblock %} 
    {% block css %}
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="{% static 'css/base.css' %}" />
    {% endblock %} 
    {% block extra_css %} 
    {% endblock %} 
    {% block js %}
    <!-- Font Awesome -->
    <script
      src="https://kit.fontawesome.com/e97ddb00dd.js"
      crossorigin="anonymous"
    ></script>
    <!-- Optional JavaScript; choose one of the two! -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
    <script src="{% static 'js/custom.js' %}"></script>
    {% endblock %} 
    {% block extra_js %} 
    {% endblock %}

    <title>ecabanas shop {% block extra_title %}{% endblock %}</title>
  </head>
  <body>
    <header class="container-fluid bg-light">
      <div class="row pt-lg-2 d-none d-lg-flex">
        <div class="col-lg-4 my-auto py-1 py-lg-2 text-left text-lg-left">
          <a href="{% url 'home' %}">
            <img src="{% static 'img/logo.png' %}" alt="ecabanas logo" class="img-fluid" />
          </a>
        </div>
        <div class="col-12 col-lg-4 my-auto py-1 py-lg-0">
          <form id="search-form">
            <div class="input-group w-100">
              <input
                type="text"
                class="form-control mr-3"
                name="search"
                placeholder="Search by title, author, or ISBN"
                value="{{ search }}"
              />
              <div class="input-group-append">
                <button
                  class="form-control btn btn-black border border-black rounded-0"
                  id="search-button"
                  type="submit"
                >
                  <span class="icon">
                    <i class="fas fa-search"></i>
                  </span>
                </button>
              </div>
            </div>
          </form>
          <ul class="book-ajax-list">
            <!-- Book list will be dynamically updated here -->
          </ul>
                    
        </div>
        <div class="col-12 col-lg-4 my-auto py-1 py-lg-0">
          <ul class="list-inline list-unstyled text-right my-0">
            <li class="list-inline-item">
              <div class="dropdown">
                {% if user.is_authenticated %}
                <a href="#" class="btn btn-link text-dark dropdown-toggle" id="account-dropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i class="fas fa-user"></i>
                </a>
                <div class="dropdown-menu border-0" aria-labelledby="account-dropdown">
                  <a href="#" class="dropdown-item">My Account</a>
                  <a href="{% url 'account_logout' %}" class="dropdown-item">Logout</a>
                </div>
                {% else %}
                <a href="#" class="btn btn-link text-dark dropdown-toggle" id="account-dropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i class="fas fa-user"></i>
                </a>
                <div class="dropdown-menu border-0" aria-labelledby="account-dropdown">
                  <a href="{% url 'account_signup' %}" class="dropdown-item">Sign Up</a>
                  <a href="{% url 'account_login' %}" class="dropdown-item">Sign In</a>
                </div>
                {% endif %}
              </div>
            </li>
            <li class="list-inline-item">
              <a href="#" class="btn btn-link text-dark">
                <i class="fas fa-shopping-cart"></i>
                <span class="badge bg-primary rounded-circle">
                  {{ cart_item_count }}
                </span>
              </a>
            </li>
          </ul>
        </div>
      </div>
      <div class="row bg-white">
        <nav class="navbar navbar-expand-lg text-jet w-100">
            <button class="navbar-light navbar-toggler" type="button" data-toggle="collapse"
                data-target="#main-nav" aria-controls="main-nav" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            {% include 'includes/main_nav.html' %}
        </nav>
    </div>
    </header>
    {% if messages %}
    <div class="message-container"></div>
    {% endif %} 
    {% block page_header %} 
    {% endblock %} 
    {% block content %} 
    {% endblock %} 
    {% include 'includes/footer.html' %}
    {% block postloadjs %} 
    <script>
      document.querySelector("#search-form").addEventListener("submit", function(event) {
        event.preventDefault();
    
        let searchTerm = document.querySelector('input[name="search"]').value;
    
        let xhr = new XMLHttpRequest();
        xhr.open("GET", "{% url 'products:book_search' %}?search=" + searchTerm, true);
        xhr.setRequestHeader("X-Requested-With", "XMLHttpRequest");
        xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}");
        xhr.onreadystatechange = function() {
          if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
            console.log(xhr.responseText);
            let books = JSON.parse(xhr.responseText).books;
            let bookList = document.querySelector(".book-ajax-list");
            bookList.innerHTML = "";
            books.forEach(function(book) {
              let bookItem = document.createElement("li");
              bookItem.innerHTML = 
                "<a href='/products/" + book.pk + "/'>" +
                  "<div class='book-ajax-list-details'>" +
                    "<img src='" + book.cover_image + "' class='book-cover-image'>" +
                    "<h4 class='book-title'>" + book.title + "</h4>" +
                  "</div>" +
                "</a>";
              bookList.appendChild(bookItem);
            });                             
          };     
        };
        xhr.send();
      });
    </script>
          
    {% endblock %}
  </body>
</html>
